---
import Image from '~/components/common/Image.astro';
const {
  id,
  images = [],
  speed = 40, // seconds per full loop
} = Astro.props;
---
<section class="relative py-16 overflow-hidden" {...(id ? { id } : {})}>
  <!-- Fade edges -->
  <div class="absolute left-0 top-0 pointer-events-none z-10 bg-gradient-to-r from-[var(--aw-color-bg-page)] to-transparent fade-edge"></div>
  <div class="absolute right-0 top-0 pointer-events-none z-10 bg-gradient-to-l from-[var(--aw-color-bg-page)] to-transparent fade-edge"></div>
  
  <!-- Carousel wrapper -->
  <div class="carousel-wrapper">
    <div class="carousel-container" style={`--scroll-speed: ${speed}s;`}>
      <!-- First loop -->
      <div class="carousel-track animate-scroll">
        {images.map((img) => (
          <div class="carousel-item">
            <Image
              class="invoice-img rounded-lg shadow-md object-contain bg-white"
              src={img.src}
              alt={img.alt || 'Invoice preview'}
              width={img.width ? Number(img.width) : 297.75}
              height={img.height ? Number(img.height) : 421.125}
              loading="lazy"
            />
          </div>
        ))}
      </div>
      <!-- Second loop (duplicate for seamless scroll) -->
      <div class="carousel-track animate-scroll">
        {images.map((img) => (
          <div class="carousel-item">
            <Image
              class="invoice-img rounded-lg shadow-md object-contain bg-white"
              src={img.src}
              alt={img.alt || 'Invoice preview'}
              width={img.width ? Number(img.width) : 297.75}
              height={img.height ? Number(img.height) : 421.125}
              loading="lazy"
            />
          </div>
        ))}
      </div>
    </div>
  </div>

  <style>
    @keyframes scroll {
      from {
        transform: translateX(0);
      }
      to {
        transform: translateX(-100%);
      }
    }

    .animate-scroll {
      animation: scroll var(--scroll-speed) linear infinite;
    }

    section:hover .animate-scroll {
      animation-play-state: paused;
    }

    .carousel-wrapper {
      overflow: visible; /* <-- changed */
      width: 100%;
    }

    .carousel-container {
      display: flex;
      width: fit-content;
      overflow: visible; /* <-- added */
    }

    .carousel-track {
      display: flex;
      flex-shrink: 0;
      overflow: visible; /* <-- added */
    }

    .carousel-item {
      flex: 0 0 auto;
      padding-inline: clamp(0.5rem, 1vw, 1rem);
      overflow: visible;
      position: relative;
    }

    .invoice-img {
      width: clamp(140px, 28vw, 420px);
      aspect-ratio: 210 / 297;
      height: auto;
      transition: transform 0.18s cubic-bezier(.6,.2,.3,1), box-shadow 0.18s cubic-bezier(.6,.2,.3,1);
      will-change: transform;
      z-index: 0;
      display: block;
    }
    .invoice-img:hover {
      transform: scale(1.055);
      z-index: 2;
      box-shadow: 0 2px 24px 0 rgba(0,0,0,0.18);
    }

    @media (max-width: 640px) {
      .invoice-img {
        width: clamp(120px, 35vw, 200px);
      }
    }

    .fade-edge {
      width: clamp(60px, 10vw, 180px);
      height: 100%;
      pointer-events: none;
    }
  </style>
</section>